parameters:
  - name: configuration
    type: string

steps:
  - template: checkout.yml

  - script: |
      sudo wget -qO /usr/local/bin/ninja.gz https://github.com/ninja-build/ninja/releases/latest/download/ninja-linux.zip
      sudo gunzip /usr/local/bin/ninja.gz
      sudo chmod a+x /usr/local/bin/ninja
    displayName: 'Install ninja'

  - script: |
      chmod +x ./Utilities/LinuxBuildScripts/curl.bash
      sudo sed -i -e 's/\r$//' ./Utilities/LinuxBuildScripts/curl.bash
      sudo bash ./Utilities/LinuxBuildScripts/curl.bash
    displayName: 'build curl'

  - script: |
      sudo cmake -S ./Utilities/CMake/Linux/openssl/libssl -B ./Build/libssl.Linux/build -D CMAKE_BUILD_TYPE=${{ parameters.configuration }} -G "Ninja"
      sudo ninja -C ./Build/libssl.Linux/build
    displayName: 'build libssl'

  - script: |
      sudo cmake -S ./Utilities/CMake/Linux/openssl/libcrypto -B ./Build/libcrypto.Linux/build -D CMAKE_BUILD_TYPE=${{ parameters.configuration }} -G "Ninja"
      sudo ninja -C ./Build/libcrypto.Linux/build
    displayName: 'build libcrypto'

  - script: |
      sudo cmake -S ./Utilities/CMake/Linux/libHttpClient -B ./Build/libHttpClient.Linux.C/build -D CMAKE_BUILD_TYPE=${{ parameters.configuration }} -G "Ninja"
      sudo ninja -C ./Build/libHttpClient.Linux.C/build
    displayName: 'build libHttpClient'
